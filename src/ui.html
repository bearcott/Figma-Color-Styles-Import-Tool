<h2>Figma Code Color Import</h2>
<input id="api" placeholder="https://app.pipe-dev.com/api/colors" />
<textarea id="code"></textarea>
<button id="refetch">Refetch</button>
<button id="create">Create</button>
<p id="error"></p>
<div id="lol"></div>

<!-- <button id="cancel">Cancel</button> -->
<script>
  const DEFAULT_API_URL = "https://app.pipe-dev.com/api/colors";
  const debounce = null;

  const apiInput = document.getElementById("api");
  const textbox = document.getElementById("code");
  const errorMsg = document.getElementById("error");
  const createButton = document.getElementById("create");
  const refetchButton = document.getElementById("refetch");

  const fetchData = async (url) => {
    try {
      const rawData = await fetch(url);
      const data = await rawData.json();
      textbox.value = JSON.stringify(data);
    } catch (e) {
      errorMsg.innerHTML = e.message;
    }
  };
  fetchData(DEFAULT_API_URL);

  refetch.onclick = () => {
    fetchData(apiInput.value || DEFAULT_API_URL);
  };

  apiInput.onchange = () => {
    clearTimeout(debounce);
    debounce = setTimeout(() => {
      fetchData(apiInput.value || DEFAULT_API_URL);
    }, 500);
  };

  createButton.onclick = () => {
    parent.postMessage(
      { pluginMessage: { type: "input-colors", code: textbox.value } },
      "*"
    );
  };
</script>
